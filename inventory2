[all:vars]
consul_key_force_rotate=false
nomad_key_force_rotate=false
ansible_ssh_user=pi
ansible_ssh_private_key_file=./id_rsa
ansible_python_interpreter=/usr/bin/python3

[consul_instances]
raspberrypi-1.home consul_node_name=rasperrypi-1 consul_node_role=server
raspberrypi-2.home consul_node_name=rasperrypi-2 consul_node_role=server

[consul_instances:vars]
consul_version=1.12.3
consul_architecture=arm 
consul_client_address=0.0.0.0
consul_connect_enabled=true
consul_encrypt_enable=true
consul_raw_key={{ lookup('env','GOSSIP_KEY') }}
consul_raft_protocol=3
consul_bootstrap_expect=true
consul_bootstrap_expect_value=1
consul_dnsmasq_enable=true
consul_dnsmasq_servers=["192.168.1.1"]

[vault_instances]
raspberrypi-1.home
raspberrypi-2.home

[vault_instances:vars]
vault_backend=consul
vault_address=0.0.0.0
vault_awskms=true
vault_awskms_region="eu-west-3"
vault_awskms_access_key={{ lookup('env','AWS_VAULT_ACCESS_KEY') }}
vault_awskms_secret_key={{ lookup('env','AWS_VAULT_SECRET_KEY') }}
vault_use_config_path=true
vault_consul=consul.service.consul:8500
vault_install_remotely=true

[nomad_instances]
raspberrypi-1.home nomad_node_role=both nomad_node_name=rasperrypi-1
raspberrypi-2.home nomad_node_role=both nomad_node_name=rasperrypi-2

[nomad_instances:vars]
nomad_version=1.3.2
nomad_use_consul=true
nomad_vault_enabled=true
nomad_vault_token={{ lookup('env','VAULT_TOKEN') }}
nomad_vault_address=http://vault.service.consul:8200
nomad_raft_protocol=3
nomad_bootstrap_expect=1
nomad_vault_create_from_role="nomad-cluster"
nomad_consul_servers_service_name=nomad
nomad_bind_address=0.0.0.0
nomad_consul_address=consul.service.consul:8500
