[all:vars]
consul_key_force_rotate=false
nomad_key_force_rotate=false
ansible_ssh_user=pi
ansible_ssh_private_key_file=/temp/secrets/id_rsa
ansible_python_interpreter=/usr/bin/python3
hcp_vault_address={{ lookup('env','VAULT_ADDR') }}
hcp_vault_token="hvs.uc6K1fiEvct1atViOfuJLLdg"
consul_template_version=0.29.1
consul_template_uri=consul-template
consul_template_gossip_key_ttl="1h"
hashicorp_url=https://releases.hashicorp.com

[consul_instances]
raspberrypi.home consul_node_name=raspberrypi-1 consul_node_role=server

[consul_instances:vars]
consul_version=1.12.3
consul_architecture=arm 
consul_client_address=0.0.0.0
consul_connect_enabled=true
consul_encrypt_enable=true
consul_raft_protocol=3
consul_bootstrap_expect=true
consul_bootstrap_expect_value={{ groups['consul_instances'] | length }}
consul_dnsmasq_enable=true
consul_dnsmasq_servers=["192.168.1.1"]

[vault_instances]
raspberrypi.home

[vault_instances:vars]
vault_backend=consul
vault_address=0.0.0.0
vault_use_config_path=true
vault_consul=127.0.0.1:8500
vault_install_remotely=true

[nomad_instances]
raspberrypi.home nomad_node_role=both nomad_node_name=rasperrypi-1

[nomad_instances:vars]
nomad_version=1.3.2
nomad_use_consul=true
nomad_vault_enabled=true
nomad_vault_token={{ lookup('env','VAULT_TOKEN') }}
nomad_vault_address=http://vault.service.consul:8200
nomad_raft_protocol=3
nomad_bootstrap_expect={{ groups['nomad_instances'] | length }}
nomad_vault_create_from_role="nomad-cluster"
nomad_consul_servers_service_name=nomad
nomad_bind_address=0.0.0.0
nomad_consul_address=127.0.0.1:8500
